<script>
document.addEventListener("DOMContentLoaded", function () {

  const micButton = document.getElementById("micButton");
  const status = document.getElementById("status");
  const ring = document.getElementById("ring");

  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

  if (!micButton || !ring || !status) {
    console.error("Missing HTML elements.");
    return;
  }

  if (!SpeechRecognition) {
    status.innerText = "Speech recognition not supported in this browser.";
    return;
  }

  let recognition = new SpeechRecognition();
  recognition.lang = "en-US";
  recognition.continuous = false;
  recognition.interimResults = false;

  recognition.onstart = () => {
    status.innerText = "Listening...";
    ring.classList.add("listening");
  };

  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    status.innerText = "You said: " + transcript;

    if (transcript.toLowerCase().includes("cancel")) {
      status.innerText = "Cancelled.";
      recognition.stop();
      return;
    }

    playSuccess();
  };

  recognition.onerror = (event) => {
    status.innerText = "Error: " + event.error;
  };

  recognition.onend = () => {
    ring.classList.remove("listening");
  };

  function playClick() {
    const audio = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
    audio.play();
  }

  function playSuccess() {
    const audio = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
    audio.play();
  }

  micButton.addEventListener("click", () => {
    playClick();
    recognition.start();
  });

});
</script>
