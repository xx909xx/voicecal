<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>VoiceCal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    h1 {
      margin-bottom: 40px;
    }

    .mic-wrapper {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .glow-ring {
      position: absolute;
      width: 220px;
      height: 220px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(0,150,255,0.4) 0%, transparent 70%);
      animation: pulseRing 2s infinite;
      opacity: 0.8;
    }

    .glow-ring.listening {
      background: radial-gradient(circle, rgba(255,0,0,0.5) 0%, transparent 70%);
    }

    @keyframes pulseRing {
      0% { transform: scale(1); opacity: 0.7; }
      50% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); opacity: 0.7; }
    }

    #micButton {
      width: 160px;
      height: 160px;
      cursor: pointer;
      animation: pulse 2s infinite;
      z-index: 2;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.08); }
      100% { transform: scale(1); }
    }

    #status {
      margin-top: 30px;
      font-size: 18px;
      min-height: 24px;
    }
  </style>
</head>

<body>

<h1>VoiceCal</h1>

<div class="mic-wrapper">
  <div id="ring" class="glow-ring"></div>
  <img src="/icon.png" id="micButton">
</div>

<div id="status">Tap the mic to speak</div>

<script>
  const micButton = document.getElementById("micButton");
  const status = document.getElementById("status");
  const ring = document.getElementById("ring");

  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

  let recognition;
  let silenceTimer;

  function playClick() {
    const audio = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
    audio.play();
  }

  function playSuccess() {
    const audio = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
    audio.play();
  }

  function vibrate() {
    if (navigator.vibrate) {
      navigator.vibrate(100);
    }
  }

  function stopListening() {
    if (recognition) recognition.stop();
    ring.classList.remove("listening");
    status.innerText = "Tap the mic to speak";
  }

  if (SpeechRecognition) {
    recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;

    recognition.onstart = () => {
      status.innerText = "Listening...";
      ring.classList.add("listening");

      silenceTimer = setTimeout(() => {
        stopListening();
      }, 6000);
    };

    recognition.onresult = (event) => {
      clearTimeout(silenceTimer);

      const transcript = event.results[0][0].transcript;
      status.innerText = "You said: " + transcript;

      if (transcript.toLowerCase().includes("cancel")) {
        status.innerText = "Cancelled.";
        stopListening();
        return;
      }

      playSuccess();
      stopListening();
    };

    recognition.onerror = () => {
      status.innerText = "Speech failed. Try again.";
      stopListening();
    };
  } else {
    status.innerText = "Speech recognition not supported.";
  }

  micButton.addEventListener("click", () => {
    playClick();
    vibrate();

    if (!SpeechRecognition) {
      status.innerText = "Speech recognition not supported.";
      return;
    }

    recognition.start();
  });
</script>

</body>
</html>
